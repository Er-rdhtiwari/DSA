### **Day 2 Notes: MongoDB, Redis, and Flask Fundamentals**

---

### **Part 1: MongoDB Basics**

MongoDB is a NoSQL document-oriented database that offers high performance, scalability, and flexibility in schema design.

#### **1. Core Concepts**

- **CRUD Operations**:
  - **Create**:
    - `insertOne(document)`
    - `insertMany([document1, document2, ...])`
  - **Read**:
    - `find(filter, projection)`
    - `findOne(filter, projection)`
  - **Update**:
    - `updateOne(filter, update)`
    - `updateMany(filter, update)`
    - `replaceOne(filter, replacement)`
  - **Delete**:
    - `deleteOne(filter)`
    - `deleteMany(filter)`

- **Schema Design**:
  - **Flexible Schema**: MongoDB allows documents within a collection to have different fields.
  - **Data Modeling**:
    - **Embedded Documents**: Embed related data in a single document.
      - Useful when you frequently need to access all the data together.
    - **Referenced Documents**: Link documents using references (similar to foreign keys).
      - Use when data is accessed separately or to avoid duplication.

- **Aggregation Framework**:
  - Used for data processing and analytics.
  - **Pipeline Stages**:
    - `$match`: Filters documents.
    - `$group`: Groups documents for aggregation.
    - `$project`: Reshapes each document.
    - `$sort`: Sorts documents.
    - `$limit`: Limits the number of documents.
    - `$lookup`: Performs left outer joins with other collections.

#### **2. Hands-On Practice**

**Scenario 1: Design a Schema for a Billing System**

**Customers Collection**:

```json
{
  "_id": ObjectId,            // Unique customer ID
  "name": "John Doe",
  "email": "john@example.com",
  "phone": "555-1234",
  "address": {
    "street": "123 Main St",
    "city": "Metropolis",
    "state": "NY",
    "zip": "12345"
  },
  "created_at": ISODate("2024-12-06T10:00:00Z")
}
```

**Invoices Collection**:

```json
{
  "_id": ObjectId,            // Unique invoice ID
  "customer_id": ObjectId,    // Reference to Customers collection
  "invoice_date": ISODate("2024-12-06T10:00:00Z"),
  "due_date": ISODate("2024-12-20T10:00:00Z"),
  "items": [
    {
      "description": "Web Hosting",
      "quantity": 2,
      "unit_price": 50.00,
      "total": 100.00
    },
    {
      "description": "Domain Registration",
      "quantity": 1,
      "unit_price": 15.00,
      "total": 15.00
    }
  ],
  "subtotal": 115.00,
  "tax": 10.35,
  "total_amount": 125.35,
  "status": "pending"         // Options: pending, paid, overdue
}
```

**Scenario 2: Write an Aggregation Pipeline to Find Total Revenue Generated by a Customer**

```javascript
db.invoices.aggregate([
  { "$match": { "customer_id": ObjectId("64a7f2c8e4b0f12d34567890") } },
  {
    "$group": {
      "_id": "$customer_id",
      "total_revenue": { "$sum": "$total_amount" }
    }
  }
])
```

**Explanation**:

- **`$match`**: Filters invoices for the specified customer.
- **`$group`**: Aggregates the total revenue.

**Sample Output**:

```json
{
  "_id": ObjectId("64a7f2c8e4b0f12d34567890"),
  "total_revenue": 5000.00
}
```

---

### **Part 2: Redis Basics**

Redis is an open-source, in-memory data structure store used as a database, cache, and message broker.

#### **1. Core Concepts**

- **Data Structures**:
  - **Strings**: Binary-safe strings.
  - **Hashes**: Maps between string fields and string values, like a dictionary.
  - **Lists**: Ordered collections of strings.
  - **Sets**: Unordered collections of unique strings.
  - **Sorted Sets**: Sets ordered by a score.
  - **Bitmaps**, **HyperLogLogs**, etc.

- **Basic Commands**:

  - **Strings**:
    - `SET key value`: Set value for a key.
    - `GET key`: Get value of a key.
    - `INCR key`: Increment value (assuming it's an integer).
    - `EXPIRE key seconds`: Set a time to live.

  - **Hashes**:
    - `HSET key field value`: Set the value of a field in a hash.
    - `HGET key field`: Get the value of a field.
    - `HGETALL key`: Get all fields and values in a hash.

- **Caching Patterns**:
  - **Cache Aside**: Application checks cache first, loads from database if missing, then stores in cache.
  - **Write Through**: Writes to cache and database simultaneously.
  - **Read Through**: Application interacts with cache provider, which loads data from database if needed.

#### **2. Hands-On Practice**

**Scenario: Implement a Caching System for an API Using Redis**

**Set Up Redis**:

- Install Redis locally or use a hosted service like Redis Labs.

**Python Example with Flask and Redis**:

```python
from flask import Flask, jsonify, request
import redis
import pymongo

app = Flask(__name__)

# Redis client
redis_client = redis.StrictRedis(host='localhost', port=6379, db=0)

# MongoDB client
mongo_client = pymongo.MongoClient('mongodb://localhost:27017/')
db = mongo_client['billing_db']
customers_collection = db['customers']

@app.route('/customers/<string:customer_id>', methods=['GET'])
def get_customer(customer_id):
    cache_key = f"customer:{customer_id}"
    
    # Check Redis cache
    cached_data = redis_client.get(cache_key)
    if cached_data:
        return jsonify({"source": "cache", "customer": json.loads(cached_data)})

    # Fetch from MongoDB
    customer = customers_collection.find_one({"_id": ObjectId(customer_id)})
    if customer:
        customer['_id'] = str(customer['_id'])  # Convert ObjectId to string
        # Store in Redis cache
        redis_client.setex(cache_key, 3600, json.dumps(customer))  # Cache expires in 1 hour
        return jsonify({"source": "database", "customer": customer})
    else:
        return jsonify({"error": "Customer not found"}), 404

if __name__ == "__main__":
    app.run(debug=True)
```

---

### **Part 3: Flask Fundamentals**

#### **1. Core Concepts**

- **Application Setup**:
  ```python
  app = Flask(__name__)
  ```

- **Routing and View Functions**:
  ```python
  @app.route('/')
  def home():
      return "Hello, World!"
  ```

- **HTTP Methods**:
  ```python
  @app.route('/users', methods=['GET', 'POST'])
  ```

- **Request and Response Objects**:
  ```python
  data = request.get_json()
  return jsonify({"message": "Success"})
  ```

---

Take your time to revise these notes, and let me know if you need further clarification on any topic! ðŸ˜Š